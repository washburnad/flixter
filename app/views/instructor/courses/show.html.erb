<script>
  $(function() {
    $('.lessons').sortable({
      update: function( event, ui ) {
      	$.ajax({
      		type: 'PUT',
      		url: ui.item.data('update-url'),
      		dataType: 'json',
      		data: { lesson: {row_order_position: ui.item.index() } }
      	});
      }
  	});
	});

	$(function() {
		$('.sections').sortable({
			update: function( event, ui ) {
				$.ajax({
					type: 'PUT',
					url: ui.item.data('update-url'),
					dataType: 'json',
					data: { section: {row_order_position: ui.item.index() } }

				});
			}
		});
	});
</script>


<div class="booyah-box col-xs-10 col-xs-offset-1">
	<h1 class='text-center'><%= current_course.title %></h1>
	<%= image_tag current_course.image, :class => 'img-responsive' %> 
	<div class='text-center'>
		<%= link_to 'Preview as student', course_path(current_course), :class => 'btn btn-primary' %>
		<%= link_to 'Add a new section', new_instructor_course_section_path(current_course), :class => 'btn btn-primary' %>
		<%= link_to 'Edit course', edit_instructor_course_path(current_course), :class => 'btn btn-primary' %>
	</div>
	<ul class='sections'>
		<% current_course.sections.rank(:row_order).each do |section| %>

			<li data-update-url="<%= instructor_course_section_path(section.course, section.id) %>" > <%= link_to section.title, '#' %><%= link_to 'Add new lesson',  new_instructor_section_lesson_path(section), :class => 'pull-right btn btn-primary btn-xs' %>
				<ul class='lessons'>
					<% section.lessons.rank(:row_order).each do |lesson| %>
						<li data-update-url="<%= instructor_lesson_path(lesson.id) %>" >
							<%= link_to lesson.title, '#' %> : <%= lesson.subtitle %>
						</li>
					<% end %>
				</ul>	
				<hr class='clr' />
			</li>
		<% end %>
	</ul>
	<br />
	<div class='col-sm-9 col-xs-12'>	
		<p><%= current_course.description %></p>
	</div>
	<div class='col-sm-3 col-xs-12'>
		<p><%= number_to_currency current_course.cost %></p>
	</div>
</div>